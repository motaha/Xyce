<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Xyce: Circuit Device How To ...</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xyce
   &#160;<span id="projectnumber">6.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('xyce_device_howto.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Circuit Device How To ... </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> Circuit Device Definitions</p>
<p>Device Definition, Creation and Initialization</p>
<ul>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_overview">Device Development Overview</a></li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_definition">Define a Device for the Xyce Simulator</a><ul>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_definition_traits">Device Traits</a></li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_definition_registration">Device Registration</a></li>
</ul>
</li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_creation">Device Factory Registry and Parameter Parsing</a><ul>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_creation_device_factory">Device Factory Registry</a></li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_creation_parameter_parse">Parameter Parsing</a></li>
</ul>
</li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_parameters">Device Parameters</a></li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_parameters_binding">Binding a Name to a Device Parameter</a></li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_parameters_processing">Initialize and Process Parameters</a></li>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_master">Device, DeviceMaster&lt;Model, Instance&gt; and Device Master</a></li>
</ul>
<p>Numerical Function Implementation</p>
<ul>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_numerical_functions">Numerical Implementation</a></li>
</ul>
<p>Sample Implementation</p>
<ul>
<li><a class="el" href="xyce_device_howto.html#xyce_device_howto_resistor">Sample Device Implementation</a></li>
</ul>
<h1><a class="anchor" id="xyce_device_howto_overview"></a>
Device Development Overview</h1>
<p>The primary task of <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> device code is to load the F and Q vectors and the dFdx and dQdx matrices as described in the <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> Math Formulation Document. Description of the details of how <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> uses these vectors and matrices is beyond the scope of this Doxygen text, and the Math Formulation document should be read before attempting to write a device from scratch.</p>
<p>The general flow of work for a device flows roughly as follows:</p>
<ul>
<li>When <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> starts up, the list of accepted parameters for all device types and their associated models are read from the Traits class associated with the device type.</li>
</ul>
<ul>
<li>The netlist is parsed to determine which devices and models need to be instantiated for the given circuit. "ModelBlock" and "InstanceBlock" objects are created by the parser containing parameters and other information provided in the netlist for use later in instantiating devices.</li>
</ul>
<ul>
<li>Model objects of the appropriate class for each .model card are created and Instance objects of the corresponding device type are associated with them. These operations are performed using the constructors for the Instance and Model classes of the device, and the addInstance method of the Model class. The constructors initialize certain internal data that will be queried later by the Topology package when it is determining the circuit connectivity and assigning locations in the solution vector and Jacobian matrix.</li>
</ul>
<ul>
<li>After the Topology package is done with its work, devices are notified through a number of "register*LIDs" functions what elements of the vectors and matrices correspond to its data.</li>
</ul>
<ul>
<li>During solution of the problem, the updateState, loadDAEVectors, and loadDAEMatrices of the device type's "Master" class are called. By default, these functions call the updatePrimaryState, loadDAEFVector/loadDAEQVector, and loadDAEdFdx/loadDAEdQdx methods of the Instance class for each device of that type.</li>
</ul>
<p>Writing device code requires understanding each step of this process, and coding the various methods to implement the device's function.</p>
<p>When creating a new device, you will need to create a header file and an implementation file. The header file contains declarations of the classes associated with a device type and the internal data used by those classes. The implementation file contains the code for the member methods of the classes declared in the header file.</p>
<p>In the include file, you will to declare a device Instance class, a device Model class and a device Traits class. The device Instance class must inherit from the DeviceInstance class and the Model class must inherit from the DeviceModel class. The device Traits class must inherit from the DeviceTraits class template. You may also define a Master class which inherits from the DeviceMaster class template. Though the operation of device instance and models are implemented in separate classes, they are all considered to be one functional unit. As such, it is common for these component classes to "friend" one another to allow them to access each other's private data, eliminiating the need for accessor functions while restricting access from other devices and subsystems.</p>
<p>The Instance and the Model classes each provide functionality for instance and model creation, parameter value setting, registration of solver components, and loading and processing of numeric values.</p>
<p>The Instance and Model classes parameters are implemented as member variables and will be referred to as "parameter member
variables." The parameter member variables provide data for the numerical methods used to describe the behavior of the device. The Traits class functions loadInstanceParameters() and loadModelParameters() describe these parameter member variables to the parsing subsystem which will populate them as each device is created.</p>
<p>Instance and Model objects are created by the DeviceMaster or its derived class. The Traits factory() function creates the device, while the addInstance() and addModel() functions of the DeviceMaster class create Instance and Model objects.</p>
<p>The Traits class defines the configuration of the device, its parameters and the device creation factory. Since device amy have special numerical processing based on the class of device, a model group exists to identify the deive class. Each of the model groups has a lead device which serves to identify the group. In most cases, the group lead is the device assigned to level one. The third template paremeter to the DeviceTraits templates is used to identify the model group of a device. If this parameter is not specified, the device becomes a model group lead.</p>
<h2><a class="anchor" id="xyce_device_howto_overview_header"></a>
Header File Layout</h2>
<p>All open source circuit devices files are in the Xyce/src/DeviceModelPKG/OpenModels directory. Proprietary and other devices exists in appropriately named sibling directies.</p>
<p>Each device is declared in its own namespace within the <a class="el" href="namespaceXyce_1_1Device.html" title="Circuit Device Definitions.">Xyce::Device</a> namespace. This allows you to place device specific classes and functions without concern for naming conflicts.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="N__DEV__fwd_8h.html">N_DEV_fwd.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="N__DEV__Configuration_8h.html">N_DEV_Configuration.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="N__DEV__DeviceInstance_8h.html">N_DEV_DeviceInstance.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="N__DEV__DeviceModel_8h.html">N_DEV_DeviceModel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="N__DEV__DeviceMaster_8h.html">N_DEV_DeviceMaster.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Model;</div>
<div class="line"><span class="keyword">class </span>Instance;</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>Traits : <span class="keyword">public</span> DeviceTraits&lt;Model, Instance&gt;</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Instance : <span class="keyword">public</span> DeviceInstance</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span>ParametricData&lt;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a5594dd6f2b39af05c13048ceee2f3ef3" title="Construct a resistor instance.">Instance</a>&gt;;              <span class="comment">///&lt; Allow ParametricData to changes member values</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a2bf2a0e9b454c55aa5dcb5aa4698697b">Model</a>;                                 <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a4952c86a9f44b3fd3e0bf4c99e72c21f">Traits</a>;</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a34b85c36cc2386b553fcff72fc15a596">Master</a>;                                <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span>...</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Model : <span class="keyword">public</span> DeviceModel</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span>ParametricData&lt;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#ac31cb99ec97512482a140abd474d307a">Model</a>&gt;;               <span class="comment">///&lt; Allow ParametricData to changes member values</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#aea90763cbe6c91bbcd6e9bf0d66dc500" title="Don&#39;t force a lot of pointless getters.">Instance</a>;                            <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a4952c86a9f44b3fd3e0bf4c99e72c21f">Traits</a>;</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a34b85c36cc2386b553fcff72fc15a596" title="Don&#39;t force a lot of pointless getters.">Master</a>;                              <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line">...</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Master : <span class="keyword">public</span> DeviceMaster&lt;Traits&gt;</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Master.html#aea90763cbe6c91bbcd6e9bf0d66dc500" title="Don&#39;t force a lot of pointless getters.">Instance</a>;                            <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Master.html#a2bf2a0e9b454c55aa5dcb5aa4698697b" title="Don&#39;t force a lot of pointless getters.">Model</a>;                               <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span>...</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceXyce_1_1Device_1_1Resistor.html#a727db6377345b6ebadf8f4096129e0ae" title="Define how to use the device in a netlist.">registerDevice</a>();</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><h2><a class="anchor" id="xyce_device_howto_overview_implementation"></a>
Implementation File Layout</h2>
<p>All open source circuit devices files are in the Xyce/src/DeviceModelPKG/OpenModels directory. Proprietary and other devices exists in appropriately named sibling directies.</p>
<p>Each device is declared in its own namespace within the <a class="el" href="namespaceXyce_1_1Device.html" title="Circuit Device Definitions.">Xyce::Device</a> namespace. This allows you to place device specific classes and functions without concern for naming conflicts.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Xyce_config.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="N__DEV__Resistor_8h.html">N_DEV_Resistor.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#aa217627d4d0f7259f5ba4839b084c905" title="Loads the parameter definition into the instance parameter map.">Traits::loadInstanceParameters</a>(ParametricData&lt;Resistor::Instance&gt; &amp;p)</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#ad096ec36ef2721715402743a1602b588" title="Loads the parameter definition into the model parameter map.">Traits::loadModelParameters</a>(ParametricData&lt;Resistor::Model&gt; &amp;p)</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">Instance::Instance(</div>
<div class="line">  <span class="keyword">const</span> Configuration &amp; configuration,</div>
<div class="line">  <span class="keyword">const</span> InstanceBlock &amp; instance_block,</div>
<div class="line">  Model &amp;               model,</div>
<div class="line">  <span class="keyword">const</span> FactoryBlock &amp;  factory_block)</div>
<div class="line">  : DeviceInstance(instance_block, configuration.getInstanceParameters(), factory_block),</div>
<div class="line">    model_(model),</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">Model::Model(</div>
<div class="line">  <span class="keyword">const</span> Configuration &amp; configuration,</div>
<div class="line">  <span class="keyword">const</span> ModelBlock &amp;    model_block,</div>
<div class="line">  <span class="keyword">const</span> FactoryBlock &amp;  factory_block)</div>
<div class="line">  : DeviceModel(model_block, configuration.getModelParameters(), factory_block),</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">Device *</div>
<div class="line">Traits::factory(<span class="keyword">const</span> Configuration &amp;configuration, <span class="keyword">const</span> FactoryBlock &amp;factory_block)</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a class="code" href="namespaceXyce_1_1Device_1_1RxnSet.html#a36d6fd7612ab9c05f10443723ae70d01">registerDevice</a>()</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><h1><a class="anchor" id="xyce_device_howto_definition"></a>
Define a Device for the Xyce Simulator</h1>
<p>To define a device for the <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> Simuator, a few properties must be provided. The properties are provided via a device traits class. The traits class binds the device Model and Instance and associates the Model with its Model Group. It also defines numeric and string properties such as node count and name. And, it declares the device creation factory and parameter binding functions.</p>
<h2><a class="anchor" id="xyce_device_howto_definition_traits"></a>
Device Traits</h2>
<p>Every device must define a Traits class. This class gives the properties of the device to DeviceMaster and the Config classes as a template parameter. The Traits class defined three types: InstanceType, ModelType and ModelGroupType. The typeid() of each of these types is used as an identifier for that type.</p>
<p>The InstanceType is the device instance class as in Resistor::Instance. The ModelType is the device model class as in Resistor::Model. And the ModelGroupType is the root model of the model group. I.E. for the ThermalResistor and Resistor3 devices, it is defined as Resistor::Model. If no model group it provided, then the ModellGroupType defaults to the ModelType and the device defines a model group.</p>
<p>The Traits also defines numeric, boolean and string properties. Many of these have an implementation in the DeviceTraits base class. However, numNodes() and isLinearDevice() are not implemented and must be implemented in each device's traits.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="classXyce_1_1Device_1_1DeviceTraits.html" title="The DeviceTraits template describes the configuration of a device.">Xyce::Device::DeviceTraits</a></dd></dl>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Model;</div>
<div class="line"><span class="keyword">class </span>Instance;</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>Traits : <span class="keyword">public</span> DeviceTraits&lt;Model, Instance&gt;</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#ae6e59da00f84e033c0f8091837b38c10">name</a>() {<span class="keywordflow">return</span> <span class="stringliteral">&quot;Resistor&quot;</span>;}</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#a0adeabbf2abdb3ec6aaff2b60c05ea43">deviceTypeName</a>() {<span class="keywordflow">return</span> <span class="stringliteral">&quot;R level 1&quot;</span>;}</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#a6dd3d77a69940979baaac32c9bf0292b">numNodes</a>() {<span class="keywordflow">return</span> 2;}</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#a6279f806848bbd4fd5b3457a8c073c32">primaryParameter</a>() {<span class="keywordflow">return</span> <span class="stringliteral">&quot;R&quot;</span>;}</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#a5b384b8e2e775c587ef448707d90104c">isLinearDevice</a>() {<span class="keywordflow">return</span> <span class="keyword">true</span>;}</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> Device *<a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#ac22aea18ce5309b6954fb4c5b94eb9eb" title="Create a new instance of the Resistor device.">factory</a>(<span class="keyword">const</span> Configuration &amp;configuration, <span class="keyword">const</span> FactoryBlock &amp;factory_block);</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#ad096ec36ef2721715402743a1602b588" title="Loads the parameter definition into the model parameter map.">loadModelParameters</a>(ParametricData&lt;Model&gt; &amp;model_parameters);</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#aa217627d4d0f7259f5ba4839b084c905" title="Loads the parameter definition into the instance parameter map.">loadInstanceParameters</a>(ParametricData&lt;Instance&gt; &amp;instance_parameters);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><h2><a class="anchor" id="xyce_device_howto_definition_registration"></a>
Device Registration</h2>
<p>Registration of a device to the device configuration is performed by the <a class="el" href="namespaceXyce_1_1Device_1_1RxnSet.html#a36d6fd7612ab9c05f10443723ae70d01">registerDevice()</a> function in each device. This function must be called for the device to exist. Generally, each <em>Library</em> has a registerLibraryDevices() function which calls all of the <a class="el" href="namespaceXyce_1_1Device_1_1RxnSet.html#a36d6fd7612ab9c05f10443723ae70d01">registerDevice()</a> functions defined in the device library.</p>
<p>To implement dynamic loading, a static object may be defined whose construtor calls <a class="el" href="namespaceXyce_1_1Device_1_1RxnSet.html#a36d6fd7612ab9c05f10443723ae70d01">registerDevice()</a>. When the shareable object is loaded, static objects are constructed automatically resulting in the registration of the device.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a class="code" href="namespaceXyce_1_1Device_1_1Resistor.html#a727db6377345b6ebadf8f4096129e0ae" title="Define how to use the device in a netlist.">registerDevice</a>()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classXyce_1_1Device_1_1Config.html#a5610c7ae7489e194f88e9393ba8e15fd" title="Adds the device to the Xyce device configuration.">Config&lt;Traits&gt;::addConfiguration</a>()</div>
<div class="line">    .registerDevice(<span class="stringliteral">&quot;r&quot;</span>, 1)</div>
<div class="line">    .registerModelType(<span class="stringliteral">&quot;r&quot;</span>, 1);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><p>The <a class="el" href="namespaceXyce_1_1Device_1_1RxnSet.html#a36d6fd7612ab9c05f10443723ae70d01">registerDevice()</a> function calls the Config&lt;Traits&gt;::addConfiguration() function which defines the device. The <a class="el" href="namespaceXyce_1_1Device_1_1RxnSet.html#a36d6fd7612ab9c05f10443723ae70d01">registerDevice()</a> and registerModelType() member functions are then called to define the device instance name and model names for the device. Note that some devices define several instance names and model names and some devices define no model names.</p>
<h1><a class="anchor" id="xyce_device_howto_parameters"></a>
Device Parameters</h1>
<p>The binding process assigns a name, type, default value and documentation to each of the parameter member variables. It also assigns an optional boolean member variable, known as a given member variable, which is a flag that is set to true if the parameter member variable was provided by the netlist.</p>
<p>The parser uses the binding information to populate the parameter member variables with values provided in the netlist and to set the given member variables to true when the parameter member variable was provided in the netlist.</p>
<p>The ParameterData&lt;void&gt;::addPar() function binds the parameter name and default value to the paremeter member variable. The parameter member variable data type and default value data type identifies the parameter type to the netlist parser. The addPar() function returns the parameter description object which can be chained to describe additional characteristics of the parameter. These characteristics include expression dependency, data units, and a brief description.</p>
<h2><a class="anchor" id="xyce_device_howto_parameter_member_variable"></a>
Device Parameter Member Variables</h2>
<p>Instance and Model parameters are defined as private data members. Boolean variables which indicate when a parameter has been specified in the netlist are also defined as private data members.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Instance : <span class="keyword">public</span> DeviceInstance</div>
<div class="line">{</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a19ed313b5e306b34cfa7197f34dcf367" title="Resistance (ohms)">R</a>;              <span class="comment">///&lt; resistance (ohms)</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line">    <span class="comment">// These are for the semiconductor resistor</span></div>
<div class="line">    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#ad8042ab772a8919c7fe0a3c92dbd3494" title="Resistor length.">length</a>;         <span class="comment">///&lt; resistor length.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a4b791461cae18402c9ac81504dc7f10b" title="Resistor width.">width</a>;          <span class="comment">///&lt; resistor width.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a41f9597dbe44c9c9b0ecc6ec337b0594" title="Temperature of this instance.">temp</a>;           <span class="comment">///&lt; temperature of this instance</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line">    <span class="comment">// Temperature dependence parameters, these can override values specified in the model</span></div>
<div class="line">    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#ad64bfd70bc35521175debcdfb5fc137f" title="First order temperature coeff.">tempCoeff1</a>;     <span class="comment">///&lt; first order temperature coeff.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a4a4c4bcac0c70babc0754ed961919314" title="Second order temperature coeff.">tempCoeff2</a>;     <span class="comment">///&lt; second order temperature coeff.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#af3351a33e9a722414a70b894931762fd" title="Externally specified device temperature.">dtemp</a>;          <span class="comment">///&lt; externally specified device temperature.</span></div>
<div class="line"><span class="comment"></span>.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">    <span class="keywordtype">bool</span>        <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#ae8a048c307a322f8455d2e49ea552810" title="First order temperation value was given in netlist.">tempCoeff1Given</a>;</div>
<div class="line">    <span class="keywordtype">bool</span>        <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#abe2e8f622c4ce4e91f0531a116729a7a" title="Second order temperature coeff was given in netlist.">tempCoeff2Given</a>;</div>
<div class="line">    <span class="keywordtype">bool</span>        <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#af5054c57ea0c3cbfd0dd21b19a868c5d" title="Externally specified device temperature was given in netlist.">dtempGiven</a>;</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Model : <span class="keyword">public</span> DeviceModel</div>
<div class="line">{</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// Semiconductor resistor parameters</span></div>
<div class="line">    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a38ecc20b8896138b36575e0a937b75c3" title="First order temperature coefficient.">tempCoeff1</a>;     <span class="comment">///&lt; first order temperature coeff.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a71d630a57c3e14fe2f11eac8496f3ff9" title="Second order temperature coefficient.">tempCoeff2</a>;     <span class="comment">///&lt; second order temperature coeff.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a60f0567183d55d2460dd62a02ffb6f34" title="Sheet resistance.">sheetRes</a>;       <span class="comment">///&lt; sheet resistance</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#ac7481cc57ad8d541a5901e898af394eb" title="Default width.">defWidth</a>;       <span class="comment">///&lt; default width</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a20ab9349159c297c6abef9874b825d07" title="Narrowing due to side etching.">narrow</a>;         <span class="comment">///&lt; narrowing due to side etching</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">double</span>      <a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#ad1bdf12e6dc2cebd2d6ea1f5b5796914" title="Parameter measurement temperature.">tnom</a>;           <span class="comment">///&lt; parameter measurement temperature</span></div>
<div class="line"><span class="comment"></span>.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><h2><a class="anchor" id="xyce_device_howto_parameters_binding"></a>
Binding a Name to a Device Parameter</h2>
<p>The parameter bindings are managed by the ParametricData class template. The addPar() functions make the binding with the device's class. The makeVector() function makes the parsing of the parameter vectorized, i.e. can be specified as a list of values rather that assigned individually.</p>
<p>The addPar() function binds the parameter member variable to the name, type and default value to its paremeter member variable. The setGivenMember() function binds data member variable used as the netlist specified value indicator. The setExpressionAccess() function indicates what variable dependencies may be specified for the parameter. The setOriginalValueStored() function tells the <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> simulator that the original specifies value should be maintained so that it may be reinitialized. The setUnit() function defines the units of the parameter. The setCategory() and setDescription() provide runtime documentation for the parameter.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#aa217627d4d0f7259f5ba4839b084c905" title="Loads the parameter definition into the instance parameter map.">Traits::loadInstanceParameters</a>(ParametricData&lt;Resistor::Instance&gt; &amp;p)</div>
<div class="line">{</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;R&quot;</span>, 1000.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a19ed313b5e306b34cfa7197f34dcf367" title="Resistance (ohms)">Resistor::Instance::R</a>)</div>
<div class="line">    .setExpressionAccess(<a class="code" href="namespaceParameterType.html#afd05c493d5775a6a7ab78661a03b54e0a90a56f01e340671787855f6306d9c197" title="Parameter may be specified as time dependent expression from netlist.">ParameterType::TIME_DEP</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a22260824c72642593b071a7c6a09f1cd">U_OHM</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Resistance&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;L&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#ad8042ab772a8919c7fe0a3c92dbd3494" title="Resistor length.">Resistor::Instance::length</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a7325844624baf1f4505b92e6f1791528">U_METER</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Length&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;W&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a4b791461cae18402c9ac81504dc7f10b" title="Resistor width.">Resistor::Instance::width</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a7325844624baf1f4505b92e6f1791528">U_METER</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Width&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;TEMP&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a41f9597dbe44c9c9b0ecc6ec337b0594" title="Temperature of this instance.">Resistor::Instance::temp</a>)</div>
<div class="line">    .setExpressionAccess(<a class="code" href="namespaceParameterType.html#afd05c493d5775a6a7ab78661a03b54e0a90a56f01e340671787855f6306d9c197" title="Parameter may be specified as time dependent expression from netlist.">ParameterType::TIME_DEP</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a98688960b41e3125d3abb48be728a5e4">U_DEGC</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Temperature&quot;</span>);</div>
<div class="line"></div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;TC1&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#ad64bfd70bc35521175debcdfb5fc137f" title="First order temperature coeff.">Resistor::Instance::tempCoeff1</a>)</div>
<div class="line">    .setGivenMember(&amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#ae8a048c307a322f8455d2e49ea552810" title="First order temperation value was given in netlist.">Resistor::Instance::tempCoeff1Given</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a7ab0d104a3e94a40340245fffa473f64">U_DEGCM1</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Linear Temperature Coefficient&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;TC2&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a4a4c4bcac0c70babc0754ed961919314" title="Second order temperature coeff.">Resistor::Instance::tempCoeff2</a>)</div>
<div class="line">    .setGivenMember(&amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#abe2e8f622c4ce4e91f0531a116729a7a" title="Second order temperature coeff was given in netlist.">Resistor::Instance::tempCoeff2Given</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4af77b07aed917213561b696e10ca5b21e">U_DEGCM2</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Quadratic Temperature Coefficient&quot;</span>);</div>
<div class="line">  p.makeVector(<span class="stringliteral">&quot;TC&quot;</span>, 2); <span class="comment">///&lt; Allow TC to be entered as a vector (TC=1,2)</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;DTEMP&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#af3351a33e9a722414a70b894931762fd" title="Externally specified device temperature.">Resistor::Instance::dtemp</a>)</div>
<div class="line">    .setGivenMember(&amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#af5054c57ea0c3cbfd0dd21b19a868c5d" title="Externally specified device temperature was given in netlist.">Resistor::Instance::dtempGiven</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a98688960b41e3125d3abb48be728a5e4">U_DEGC</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Device Temperature -- For compatibility only. Parameter is NOT used&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#ad096ec36ef2721715402743a1602b588" title="Loads the parameter definition into the model parameter map.">Traits::loadModelParameters</a>(ParametricData&lt;Resistor::Model&gt; &amp;p)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Create parameter definitions for parameter member variables</span></div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;TC1&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a38ecc20b8896138b36575e0a937b75c3" title="First order temperature coefficient.">Resistor::Model::tempCoeff1</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a7ab0d104a3e94a40340245fffa473f64">U_DEGCM1</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Linear Temperature Coefficient&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;TC2&quot;</span>, 0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a71d630a57c3e14fe2f11eac8496f3ff9" title="Second order temperature coefficient.">Resistor::Model::tempCoeff2</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4af77b07aed917213561b696e10ca5b21e">U_DEGCM2</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Quadratic Temperature Coefficient&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;RSH&quot;</span>,   0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a60f0567183d55d2460dd62a02ffb6f34" title="Sheet resistance.">Resistor::Model::sheetRes</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a22260824c72642593b071a7c6a09f1cd">U_OHM</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Sheet Resistance&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;DEFW&quot;</span>,  1.e-5, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#ac7481cc57ad8d541a5901e898af394eb" title="Default width.">Resistor::Model::defWidth</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a7325844624baf1f4505b92e6f1791528">U_METER</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Default Instance Width&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;NARROW&quot;</span>,0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#a20ab9349159c297c6abef9874b825d07" title="Narrowing due to side etching.">Resistor::Model::narrow</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a7325844624baf1f4505b92e6f1791528">U_METER</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Narrowing due to side etching&quot;</span>);</div>
<div class="line">  p.addPar(<span class="stringliteral">&quot;TNOM&quot;</span>,  0.0, &amp;<a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Model.html#ad1bdf12e6dc2cebd2d6ea1f5b5796914" title="Parameter measurement temperature.">Resistor::Model::tnom</a>)</div>
<div class="line">    .setUnit(<a class="code" href="namespaceXyce_1_1Device_1_1Units.html#acfc6b9940292ffbc3cd3f056911ff1c4a98688960b41e3125d3abb48be728a5e4">U_DEGC</a>)</div>
<div class="line">    .setDescription(<span class="stringliteral">&quot;Parameter Measurement Temperature&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><h1><a class="anchor" id="xyce_device_howto_parameters_processing"></a>
Initialize and Process Parameters</h1>
<p>The device model and device instance are derived from DeviceModel and DeviceInstance base classes, respectively. These classes and their base classes implement the functions to bind names specified in the netlist to their corresponding member variables. These functions initialize the parameter member variables to the binding's default value, assign the value specified in the netlist or to a value calculated from other parameters or the device environment.</p>
<p>During construction of a device model or instance, setDefaultParams(), setParams() should be calls to populate the parameter member variables with the default value or the value provided by the netlist. Then the given() function or the use of the given member variable can be used to determine if a parameter's value was provided by the netlist.</p>
<dl class="section warning"><dt>Warning</dt><dd>The parameter member variable values in the initializers of the constructor are always overwritten by the parameter binding operation to be the default value from the binding or the value from the netlist.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line"><a class="code" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html#a5594dd6f2b39af05c13048ceee2f3ef3" title="Construct a resistor instance.">Instance::Instance</a>(</div>
<div class="line">  <span class="keyword">const</span> Configuration &amp; configuration,</div>
<div class="line">  <span class="keyword">const</span> InstanceBlock &amp; instance_block,</div>
<div class="line">  Model &amp;               model,</div>
<div class="line">  <span class="keyword">const</span> FactoryBlock &amp;  factory_block)</div>
<div class="line">  : DeviceInstance(instance_block, configuration.getInstanceParameters(), factory_block),</div>
<div class="line">    model_(model),</div>
<div class="line">    R(0.0),</div>
<div class="line">    width(0.0),</div>
<div class="line">    length(0.0),</div>
<div class="line">    temp(device_options.temp.dVal()),</div>
<div class="line">    tempCoeff1(0.0),</div>
<div class="line">    tempCoeff2(0.0),</div>
<div class="line">    dtemp(0.0),</div>
<div class="line">    tempCoeff1Given(false),</div>
<div class="line">    tempCoeff2Given(false),</div>
<div class="line">    dtempGiven(false),</div>
<div class="line">...</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">  <span class="comment">// Set params to constant default values:</span></div>
<div class="line">  setDefaultParams();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set params according to instance line and constant defaults from metadata.</span></div>
<div class="line">  setParams(instance_block.params);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set any non-constant parameter defaults:</span></div>
<div class="line">  <span class="keywordflow">if</span> (!given(<span class="stringliteral">&quot;TEMP&quot;</span>))</div>
<div class="line">    temp = device_options.temp.dVal();</div>
<div class="line">  <span class="keywordflow">if</span> (!given(<span class="stringliteral">&quot;W&quot;</span>))</div>
<div class="line">    width = model_.defWidth;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!tempCoeff1Given)</div>
<div class="line">    tempCoeff1 = model_.tempCoeff1;</div>
<div class="line">  <span class="keywordflow">if</span> (!tempCoeff2Given)</div>
<div class="line">    tempCoeff2 = model_.tempCoeff2;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Calculate any parameters specified as expressions:</span></div>
<div class="line">  updateDependentParameters();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// calculate dependent (ie computed) params and check for errors:</span></div>
<div class="line">  <span class="keywordflow">if</span> (!given(<span class="stringliteral">&quot;R&quot;</span>))</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (model_.given(<span class="stringliteral">&quot;RSH&quot;</span>) &amp;&amp; given(<span class="stringliteral">&quot;L&quot;</span>) &amp;&amp; (model_.sheetRes != 0) &amp;&amp;</div>
<div class="line">        (length != 0))</div>
<div class="line">    {</div>
<div class="line">      R = model_.sheetRes * (length - model_.narrow)</div>
<div class="line">          / (width - model_.narrow);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      R = 1000.0;</div>
<div class="line">      UserWarning0(*<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">&quot;Resistance is set to 0, setting to the default, &quot;</span> &lt;&lt; R &lt;&lt; <span class="stringliteral">&quot; ohms&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  processParams();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> Instance::processParams(<span class="keywordtype">string</span> param)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// now set the temperature related stuff.</span></div>
<div class="line">  <span class="keywordflow">return</span> updateTemperature(temp);</div>
<div class="line">}</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">Model::Model(</div>
<div class="line">  <span class="keyword">const</span> Configuration &amp; configuration,</div>
<div class="line">  <span class="keyword">const</span> ModelBlock &amp;    model_block,</div>
<div class="line">  <span class="keyword">const</span> FactoryBlock &amp;  factory_block)</div>
<div class="line">  : DeviceModel(model_block, configuration.getModelParameters(), factory_block),</div>
<div class="line">    tempCoeff1(0.0),</div>
<div class="line">    tempCoeff2(0.0),</div>
<div class="line">    sheetRes(0.0),</div>
<div class="line">    defWidth(10e-6),</div>
<div class="line">    narrow(0.0),</div>
<div class="line">    tnom(device_options.tnom),</div>
<div class="line">...</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">  <span class="comment">// Set params to constant default values:</span></div>
<div class="line">  setDefaultParams();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set params according to .model line and constant defaults from metadata:</span></div>
<div class="line">  setModParams(model_block.params);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set any non-constant parameter defaults:</span></div>
<div class="line">  <span class="keywordflow">if</span> (!given(<span class="stringliteral">&quot;TNOM&quot;</span>))</div>
<div class="line">    tnom = device_options.tnom;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Calculate any parameters specified as expressions:</span></div>
<div class="line">  updateDependentParameters();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// calculate dependent (ie computed) params and check for errors:</span></div>
<div class="line">  processParams();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> Model::processParams(<span class="keywordtype">string</span> param)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> Model::processInstanceParams(<span class="keywordtype">string</span> param)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (InstanceVector::const_iterator it = getInstanceVector().begin(); it != getInstanceVector().end(); ++it)</div>
<div class="line">  {</div>
<div class="line">    (*it)-&gt;processParams();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><h1><a class="anchor" id="xyce_device_howto_master"></a>
Device, DeviceMaster&lt;Model, Instance&gt; and Device Master</h1>
<p>The Device base class serves as the interface for managing devices. The DeviceMaster template is the primary implementer of that interface and several devices inherit from this and call this class Master.</p>
<p>The Device interface class implements the Device::addDevice() and Device::addModel() functions which create a new device model or a new device instance of that model type. It also manages a map of all device models of that model type and a vector of device instances of that model type.</p>
<p>The default Master or the DeviceMaster&lt;Model, Instance&gt; methods updateState, loadDAEVectors, and loadDAEMatrices simply loop over all device instances of the associated Instance class and call their updatePrimaryState, loadDAEFVector/loadDAEQVector, and loadDAEdFdx/loadDAEdQdx methods, respectively. By overloading the Master methods it is possible to improve performance iterating over all the instances of a device class and performing computations or loads directly rather that iterating over the instances of those models and calling member methods.</p>
<p>Refer to <a class="el" href="xyce_device_howto.html#xyce_device_howto_numerical_functions">Numerical Implementation</a> for detail on the Device interface numerical functions.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Master : <span class="keyword">public</span> DeviceMaster&lt;Model, Instance&gt;</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span>Instance;                            <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">friend</span> <span class="keyword">class </span>Model;                               <span class="comment">///&lt; Don&#39;t force a lot of pointless getters</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Master(</div>
<div class="line">      <span class="keyword">const</span> Configuration &amp;     configuration,</div>
<div class="line">      <span class="keyword">const</span> FactoryBlock &amp;      factory_block,</div>
<div class="line">      <span class="keyword">const</span> SolverState &amp;       solver_state,</div>
<div class="line">      <span class="keyword">const</span> DeviceOptions &amp;     device_options)</div>
<div class="line">      : DeviceMaster&lt;Traits&gt;(configuration, factory_block, solver_state, device_options)</div>
<div class="line">    {}</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="xyce_device_howto_creation"></a>
Device Factory Registry and Parameter Parsing</h1>
<p>While a netlist is being read, Model objects are created and for each Model created one or more Instances are attached to that Model. There may be several different Models of the same type created, each having its own values of the common model parameter member variables, and each Instance created may have it own parameter member variables.</p>
<p>The parser reads a line from the netlist. If it is a model command, it creates a new device model of the appropriate model type with the specified name. If it is a device command, it creates a new device instance and adds it to the specified device model or to the default device model for the model type. The device manager functions, DeviceMgr::addDeviceModel() and DeviceMgr::addDeviceInstance(), perform these tasks.</p>
<h2><a class="anchor" id="xyce_device_howto_creation_device_factory"></a>
Device Factory Registry</h2>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Xyce {</div>
<div class="line"><span class="keyword">namespace </span>Device {</div>
<div class="line"><span class="keyword">namespace </span>Resistor {</div>
<div class="line"></div>
<div class="line">Device *</div>
<div class="line"><a class="code" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html#ac22aea18ce5309b6954fb4c5b94eb9eb" title="Create a new instance of the Resistor device.">Traits::factory</a>(<span class="keyword">const</span> Configuration &amp;configuration, <span class="keyword">const</span> FactoryBlock &amp;factory_block)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">new</span> Master(configuration, factory_block, factory_block.solverState_, factory_block.deviceOptions_);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// namespace Resistor</span></div>
<div class="line">} <span class="comment">// namespace Device</span></div>
<div class="line">} <span class="comment">// namespace Xyce</span></div>
</div><!-- fragment --><h2><a class="anchor" id="xyce_device_howto_creation_parameter_parse"></a>
Parameter Parsing</h2>
<p>As the netlist is parsed, ModelBlock and InstanceBlock objects are created and the parameters added for each device and model command. After the netlist has been loaded, the toplogy is constructed from the node connections, then device models are constructed first using the ModelBlocks objects and the the device instances are then created using the InstanceBlocks. The DeviceMgr::addDeviceModel() function discovers the model type, then creates a new device model of that type and initializes it with values from the ModelBlock. The DeviceMgr::addDeviceInstance() function finds the model for the model type, then creates a new device instance and initializes it the the values from the InstanceBlock.</p>
<h1><a class="anchor" id="xyce_device_howto_numerical_functions"></a>
Numerical Implementation</h1>
<h2><a class="anchor" id="xyce_device_howto_numerical_allocation"></a>
xyce_device_howto_numerical_allocation</h2>
<p>The constructor for the device establishes a count of required numbers of internal and external solution variables, store variables, and solution variables. It also sets a data structure called a "Jacobian Stamp" that informs the Topology package how the equations of the device depend on solution variables. The topology package will use this information to assign locations in the various vectors and matrices to the device, and will return that information to the device in the form of vectors of "Local IDs" (LIDs).</p>
<p>The registerLIDs(), registerStateLIDs() and registerStoreLIDs() functions provide the storage location information to the instance. These methods should save the information in instance variables, so they can used by the device each time it is required to load vectors and matrices.</p>
<h2><a class="anchor" id="xyce_device_howto_device_computation"></a>
xyce_device_howto_device_computation</h2>
<p>The updatePrimaryState and updateIntermediateVars are where most of the computations for a device occur. The updateIntermediateVars method computes all the quantities needed to load the F and Q, the dFdx and dQdx matrices, and the state variables, but does not load them. updatePrimaryState loads the state vector as appropriate from information computed by updateIntermediateVars.</p>
<p>loadDAEFVector and loadDAEQVector load the F and Q vectors that appear in the DAE formulation of the circuit problem, using quantities computed in updateIntermediateVars. loadDAEdFdx and loadDAEdQdx similarly load the derivative matrices of the F and Q vectors with respect to the solution variables.</p>
<h1><a class="anchor" id="xyce_device_howto_resistor"></a>
Sample Device Implementation</h1>
<p>Several devices in <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a> have been commented extensively to aid the process of learning how to implement new devices. The Doxygen documentation for these is useful for an overview of what the methods should do, and the code itself can be browsed for more detail.</p>
<p>The resistor device is the simplest device in <a class="el" href="namespaceXyce.html" title="Root namespace for the Xyce project.">Xyce</a>, and serves as a reference implementation for the tasks of parameter definition and device creation. Further, it shows how to overload the Master class functions for efficiency, and how to implement computation and vector/matrix loading in a device.</p>
<ul>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="classXyce_1_1Device_1_1Resistor_1_1Master.html" title="Resistor master.">Xyce::Device::Resistor::Master</a></dd></dl>
</li>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="classXyce_1_1Device_1_1Resistor_1_1Instance.html" title="Resistor device instance class.">Xyce::Device::Resistor::Instance</a></dd></dl>
</li>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="classXyce_1_1Device_1_1Resistor_1_1Model.html" title="Resistor model class.">Xyce::Device::Resistor::Model</a></dd></dl>
</li>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="structXyce_1_1Device_1_1Resistor_1_1Traits.html">Xyce::Device::Resistor::Traits</a></dd></dl>
The capacitor device is as simple as the resistor, but since it is a charge storage device, also demonstrates how the Q and dQdx structures are used.</li>
</ul>
<ul>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="classXyce_1_1Device_1_1Capacitor_1_1Master.html" title="Capacitor Master class.">Xyce::Device::Capacitor::Master</a></dd></dl>
</li>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="classXyce_1_1Device_1_1Capacitor_1_1Instance.html" title="Capacitor instance.">Xyce::Device::Capacitor::Instance</a></dd></dl>
</li>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="classXyce_1_1Device_1_1Capacitor_1_1Model.html" title="Capacitor Model class.">Xyce::Device::Capacitor::Model</a></dd></dl>
</li>
<li><dl class="section see"><dt>See Also</dt><dd><a class="el" href="structXyce_1_1Device_1_1Capacitor_1_1Traits.html">Xyce::Device::Capacitor::Traits</a> </dd></dl>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li>
    <li class="footer">Generated on Mon Mar 24 2014 10:54:41 for Xyce by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
